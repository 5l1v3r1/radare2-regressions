#!/bin/sh

# GPL 3+ - Copyright (C) 2015  pancake

for a in . .. ../.. ; do [ -e $a/tests.sh ] && . $a/tests.sh ; done

NAME='2step push x86-32'
FILE=-
ARGS=
CMDS='
e esil.debug=true
e asm.arch=x86
e asm.bits=32
aei
aeim
aer esp=0x00108000
.aer*
"wa mov eax, 0x1234;push eax"
2aes
.aer*
aer?esp
?v [esp]
'
EXPECT='0x00107ffc
0x1234
'
run_test

NAME='movsb 1 byte x86-32'
FILE=-
ARGS=
CMDS='
e esil.debug=true
e asm.arch=x86
e asm.bits=32
aei
aeim
aer esp=0x00108000
aeim 0x10000000 10 source
wx 12 @ 0x10000000
aeim 0x20000000 10 destination
aer edi=0x20000000
aer esi=0x10000000
.aer*
"wx a4"
2aes
.aer*
aer?edi
aer?esi
pv @0x20000000
'
EXPECT='0x20000001
0x10000001
0x12
'
run_test

NAME='rep movsb string x86-32'
FILE=-
ARGS=
CMDS='
e esil.debug=true
e asm.arch=x86
e asm.bits=32
aei
aeim
aer esp=0x00108000
aeim 0x10000000 10 source
wx 1234567890 @ 0x10000000
aeim 0x20000000 10 destination
aer edi=0x20000000
aer esi=0x10000000
aer ecx=10
.aer*
"wx f3a4"
aes
.aer*
aer?edi
aer?esi
pv @0x20000000
aer?ecx
'
EXPECT='0x2000000a
0x1000000a
0x78563412
0x00000000
'
run_test

NAME='lodsb x86-32'
FILE=-
ARGS=
CMDS='
e esil.debug=true
e asm.arch=x86
e asm.bits=32
aei
aeim
aer esp=0x00108000
aeim 0x10000000 10 source
wx 12 @ 0x10000000
aer esi=0x10000000
.aer*
"wx ac"
1aes
.aer*
aer?esi
aer?al
'
EXPECT='0x10000001
0x00000012
'
run_test

NAME='lodsw x86-32'
FILE=-
ARGS=
CMDS='
e esil.debug=true
e asm.arch=x86
e asm.bits=32
aei
aeim
aer esp=0x00108000
aeim 0x10000000 10 source
wx 3412 @ 0x10000000
aer esi=0x10000000
.aer*
"wx 66ad"
1aes
.aer*
aer?esi
aer?ax
'
EXPECT='0x10000002
0x00001234
'
run_test

NAME='lodsd x86-32'
FILE=-
ARGS=
CMDS='
e esil.debug=true
e asm.arch=x86
e asm.bits=32
aei
aeim
aer esp=0x00108000
aeim 0x10000000 10 source
wx 563412 @ 0x10000000
aer esi=0x10000000
.aer*
"wx ad"
1aes
.aer*
aer?esi
aer?eax
'
EXPECT='0x10000004
0x00123456
'
run_test


NAME='stosb x86-32'
FILE=-
ARGS=
CMDS='
e esil.debug=true
e asm.arch=x86
e asm.bits=32
aei
aeim
aer esp=0x00108000
aeim 0x10000000 10 source
aer al=0x12
aer edi=0x10000000
.aer*
"wx aa"
1aes
.aer*
aer?edi
pv @0x10000000
'
EXPECT='0x10000001
0x12
'
run_test

NAME='stosw x86-32'
FILE=-
ARGS=
CMDS='
e esil.debug=true
e asm.arch=x86
e asm.bits=32
aei
aeim
aer esp=0x00108000
aeim 0x10000000 10 source
aer ax = 0x1234
aer edi=0x10000000
.aer*
"wx 66ab"
1aes
.aer*
aer?edi
pv @0x10000000
'
EXPECT='0x10000002
0x1234
'
run_test

NAME='stosd x86-32'
FILE=-
ARGS=
CMDS='
e esil.debug=true
e asm.arch=x86
e asm.bits=32
aei
aeim
aer esp=0x00108000
aeim 0x10000000 10 source
aer eax = 0x123456
aer edi=0x10000000
.aer*
"wx ab"
1aes
.aer*
aer?edi
pv @0x10000000
'
EXPECT='0x10000004
0x123456
'
run_test
